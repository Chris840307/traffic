<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=big5">
<title>舉發單信封黏貼標籤</title>
<style media=print>
.Noprint{display:none;}
.PageNext{page-break-after: always;}
</style>
</head>
<!--#include virtual="traffic/Common/DB.ini"-->

<body>

<%
strCity="select value from Apconfigure where id=31"
set rsCity=conn.execute(strCity)
sys_City=trim(rsCity("value"))
rsCity.close
set rsCity=nothing
'sys_City="彰化縣"
'--------------------------------------------------------------------------------------------------------------------
'登入者、單位地址
	strUNit="select UnitName,Address from UnitInfo where UnitID='"&Session("Unit_ID")&"'"
	set rsUNit=conn.execute(strUNit)
		if not rsUNit.eof then
			UnitName=trim(rsUNit("UnitName"))
			Address=trim(rsUNit("Address"))
		end If
	rsUNit.close
	set rsUNit=nothing	
'縣市名稱	
strCityName="select value from apconfigure where name='縣市名稱'"
set rsCityName=conn.execute(strCityName)
		if not rsCityName.eof then
			CityName=trim(rsCityName("value"))
		end If
	rsCityName.close
	set rsCityName=nothing	
'管轄郵遞區號
strCode="select value from apconfigure where name='管轄郵遞區號'"
set rsCode=conn.execute(strCode)
		if not rsCode.eof then
			Code=trim(rsCode("value"))
		end If
	rsCode.close
	set rsCode=nothing	
	Set DelphiASPObj = Server.CreateObject("GenBarCode.BarCodeASP")
'------------------------------------------------------------------------------------------------
If sys_City="彰化縣" Then 

		tempSQL="where (a.BillTypeID='2' and a.ExchangeTypeID=d.DCIActionID(+) and a.DCIReturnStatusID=d.DCIReturn(+) and a.RecordMemberID=b.MemberID(+) and a.BillTypeID=c.ID(+) and a.ExchangeTypeID=e.DCIActionID(+) and a.DCIERRORCARDATA=h.DciReturn(+) and a.DCIERRORIDDATA=g.DciReturn(+) and a.BillSN=f.SN and a.BillNo=f.BillNo and f.RecordStateId <> -1 and d.DCIRETURNSTATUS='1' and a.ExchangeTypeID<>'E' and a.DciErrorCarData Not in ('1','3','9','a','j','A','H','K','L','T','V','n') and a.DciReturnStatusID<>'n' "&request("sys_strSQL")&") or ((a.BillTypeID='1' or f.UseTool=8) and a.ExchangeTypeID=d.DCIActionID(+) and a.DCIReturnStatusID=d.DCIReturn(+) and a.RecordMemberID=b.MemberID(+) and a.BillTypeID=c.ID(+) and a.ExchangeTypeID=e.DCIActionID(+) and a.DCIERRORCARDATA=h.DciReturn(+) and a.DCIERRORIDDATA=g.DciReturn(+) and a.BillSN=f.SN and a.BillNo=f.BillNo and f.RecordStateId <> -1 and d.DCIRETURNSTATUS='1' and a.ExchangeTypeID<>'E' and f.RecordStateId <> -1 "&request("sys_strSQL")&")"
	strBil="select a.BillSN from DCILog a,MemberData b,(select * from DCIcode where TypeID=2) c,DCIReturnStatus d,(select distinct DCIACTIONID,DCIACTIONNAME from DCIReturnStatus) e,BillBase f,(select * from DciReturnStatus where DciActionID='WE') g,(select * from DciReturnStatus where DciActionID='WE') h "&tempSQL&" order by f.RecordDate"

	set rsbil=conn.execute(strBil)
	PBillSN=""
	while Not rsbil.eof
		if trim(PBillSN)<>"" then PBillSN=trim(PBillSN)&","
		PBillSN=PBillSN&rsbil("BillSN")
		rsbil.movenext
	wend
	Set rsbil=Nothing

	if (OptionStoreAndSendMailChk=2 or Instr(request("Sys_BatchNumber"),"N")>0) and trim(PBillSN)<>"" then
		strSQL="Select BillSN from BillMailHistory where BillSN in("&PBillSN&") order by UserMarkDate"
		set rshis=conn.execute(strSQL)
		PBillSN=""
		while Not rshis.eof
			if trim(PBillSN)<>"" then PBillSN=trim(PBillSN)&","
			PBillSN=PBillSN&rshis("BillSN")
			rshis.movenext
		wend
		rshis.close
	End if
	PBillSN=Split(trim(PBillSN),",")

Else
	PBillSN=(split(trim(request("PBillSN")),","))
End if



for i=0 to Ubound(PBillSN)

if cint(i)>0 and i mod 5=0 then response.write "<div class=""PageNext"">&nbsp;</div>"

if i mod 5=0 then 

'---------------------------------------------------------------------------------------
strBill="select b.Billno,b.CarNo,a.Owner,a.DriverHomeZip,a.Driver,b.BillTypeID,a.DriverHomeAddress,a.OwnerZip,a.OwnerAddress,c.StationName from billbasedcireturn a,Billbase b,Station c where a.DciReturnStation=c.DCIStationID(+) and a.BillNO=b.BillNo and a.CarNo=b.CarNo and a.ExchangeTypeID='W' and b.SN="&PBillSN(i)

set rsBill=conn.execute(strBill)
			GetMailAddress=""
			Billno=""
			StationName=""
			CarNo=""
			Owner=""
			Sys_BillTypeID=""
			OwnerZip=""
			 Sys_DriverHomeAddress=""
             Sys_DriverHomeZip=""
    	     Sys_Driver=""
			Sys_BillNo_BarCode=""
			ZipName2=""
		if not rsBill.eof then
		if sys_City="基隆市" or sys_City="金門縣" or sys_City="澎湖縣" then
				ZipName=""
			else
				strZip="select ZipName from Zip where ZipID='"&trim(rsBill("OwnerZip"))&"'"
				set rsZip=conn.execute(strZip)
				if not rsZip.eof then
					ZipName=trim(rsZip("ZipName"))
				end if
				rsZip.close
				set rsZip=nothing
				strZip="select ZipName from Zip where ZipID='"&trim(rsBill("DriverHomeZip"))&"'"
				set rsZip=conn.execute(strZip)
				if not rsZip.eof then
					ZipName2=trim(rsZip("ZipName"))
				end if
				rsZip.close
				set rsZip=nothing
			end if
				GetMailAddress=ZipName&trim(rsBill("OwnerAddress"))
			
			Billno=trim(rsBill("Billno"))
			StationName=trim(rsBill("StationName"))
			CarNo=trim(rsBill("CarNo"))
			Owner=trim(rsBill("Owner"))
			Sys_BillTypeID=trim(rsBill("BillTypeID"))
			OwnerZip=trim(rsBill("OwnerZip"))
			
			 Sys_DriverHomeAddress=ZipName2&trim(rsBill("DriverHomeAddress"))
                 Sys_DriverHomeZip=trim(rsBill("DriverHomeZip"))
			     Sys_Driver=trim(rsBill("Driver"))
			
			Sys_BillNo_BarCode=BillNo
			
            	DelphiASPObj.GenSendStoreBillno BillNo,0,50,160
			If sys_City="台東縣" Then 
				If Driver="" Or Sys_DriverHomeAddress="" Then 
				strBill="select a.Owner,a.OwnerZip,a.OwnerAddress,a.DriverHomeZip,a.DriverHomeAddress,a.Driver from billbasedcireturn a where a.ExchangeTypeID='A' and a.Carno='"&CarNo&"'"

				set rsBill=conn.execute(strBill)
					if not rsBill.eof Then
						ZipName=""
							strZip="select ZipName from Zip where ZipID='"&trim(rsBill("OwnerZip"))&"'"
							set rsZip=conn.execute(strZip)
							if not rsZip.eof then
								ZipName=trim(rsZip("ZipName"))
							end if
							rsZip.close
							set rsZip=Nothing

							GetMailAddress=ZipName&trim(rsBill("OwnerAddress"))
							GetMailAddress=replace(GetMailAddress,ZipName&ZipName,ZipName)

							strZip="select ZipName from Zip where ZipID='"&trim(rsBill("DriverHomeZip"))&"'"
							set rsZip=conn.execute(strZip)
							if not rsZip.eof then
								ZipName2=trim(rsZip("ZipName"))
							end if
							rsZip.close
							set rsZip=nothing


						Owner=trim(rsBill("Owner"))
						OwnerZip=trim(rsBill("OwnerZip"))
						 Sys_DriverHomeZip=trim(rsBill("DriverHomeZip"))
						 Sys_DriverHomeAddress=ZipName2&trim(rsBill("DriverHomeAddress"))
							Sys_DriverHomeAddress=replace(Sys_DriverHomeAddress,ZipName2&ZipName2,ZipName2)

						 Sys_Driver=trim(rsBill("Driver"))

					End if
				End If 
			End if
			
		end If
	rsBill.close
	set rsBill=nothing	
'-------------------------------------------------------------------------------------



%>
	
	<table border="0" width="80%" id="table1" cellspacing="0" cellpadding="0">
		<tr>
			<td height="100" width="60%">
				<p align="center">
				<font face="標楷體" size="5"><%
				'宜蘭停管單退要抓戶籍
				if (Sys_BillTypeID="1") and trim(Sys_DriverHomeAddress)<>"" then 
				  If Trim(Sys_Driver)="" Then 				
					response.write Owner 
				  Else
					response.write Sys_Driver 
				  End if
				else 
					response.write Owner
				end if
				%>
				<%if sys_City="彰化縣" then
				response.write "　先生/女士"
				end if
				%>
				</font></td>
    <td>
              <p align="left">
              <img src="..\BarCodeImage\<%=Sys_BillNo_BarCode%>.jpg"><font face="標楷體" size="2"><%if sys_City="台中縣" then  response.write StationName%></font></td>
    		</tr>
	    	<tr>
			<td height="120" align="left" valign="top" colspan="2">
				<font face="標楷體" size="5"><%
				if (Sys_BillTypeID="1" or (sys_City="宜蘭縣" and trim(Session("Ch_Name"))="楊玉燕")) and trim(Sys_DriverHomeAddress)<>""  then
				  If Trim(Sys_DriverHomeZip)="" Then 
					response.write OwnerZip 
				  Else
					response.write Sys_DriverHomeZip 
				  End if
				else 
					response.write OwnerZip  
				end if
				%>&nbsp;<%
				if (Sys_BillTypeID="1" or (sys_City="宜蘭縣" and trim(Session("Ch_Name"))="楊玉燕")) and trim(Sys_DriverHomeAddress)<>""  then 
				  If Trim(Sys_DriverHomeAddress)="" Then 
					response.write GetMailAddress
				  Else
					response.write Sys_DriverHomeAddress
				  End if
				else 
					response.write GetMailAddress 
				end if
					%></font>
         　</td>
		</tr>
	</table>
	<% 
	'---------------------------------------------------------------------------------------
	if (i+1 < Ubound(PBillSN)) or (i+1 = Ubound(PBillSN))then 
strBill="select b.Billno,b.CarNo,a.Owner,a.DriverHomeZip,a.Driver,b.BillTypeID,a.DriverHomeAddress,a.OwnerZip,a.OwnerAddress,c.StationName from billbasedcireturn a,Billbase b,Station c where a.DciReturnStation=c.DCIStationID(+) and a.BillNO=b.BillNo and a.CarNo=b.CarNo and a.ExchangeTypeID='W' and b.SN="&PBillSN(i+1)

set rsBill=conn.execute(strBill)
			GetMailAddress=""
			Billno=""
			StationName=""
			CarNo=""
			Owner=""
			Sys_BillTypeID=""
			OwnerZip=""
			 Sys_DriverHomeAddress=""
             Sys_DriverHomeZip=""
    	     Sys_Driver=""
			Sys_BillNo_BarCode=""
			ZipName2=""
		if not rsBill.eof then
		
	    	if sys_City="基隆市" or sys_City="金門縣" or sys_City="澎湖縣" then
				ZipName=""
			else
				strZip="select ZipName from Zip where ZipID='"&trim(rsBill("OwnerZip"))&"'"
				set rsZip=conn.execute(strZip)
				if not rsZip.eof then
					ZipName=trim(rsZip("ZipName"))
				end if
				rsZip.close
				set rsZip=nothing
				strZip="select ZipName from Zip where ZipID='"&trim(rsBill("DriverHomeZip"))&"'"
				set rsZip=conn.execute(strZip)
				if not rsZip.eof then
					ZipName2=trim(rsZip("ZipName"))
				end if
				rsZip.close
				set rsZip=nothing
			end if
				GetMailAddress=ZipName&trim(rsBill("OwnerAddress"))
			
			Billno=trim(rsBill("Billno"))
			StationName=trim(rsBill("StationName"))
			CarNo=trim(rsBill("CarNo"))
			Owner=trim(rsBill("Owner"))
			Sys_BillTypeID=trim(rsBill("BillTypeID"))
			OwnerZip=trim(rsBill("OwnerZip"))
			
			 Sys_DriverHomeAddress=ZipName2&trim(rsBill("DriverHomeAddress"))
                 Sys_DriverHomeZip=trim(rsBill("DriverHomeZip"))
			     Sys_Driver=trim(rsBill("Driver"))

			Sys_BillNo_BarCode=BillNo
			
            	DelphiASPObj.GenSendStoreBillno BillNo,0,50,160
			If sys_City="台東縣" Then 
				If Driver="" Or Sys_DriverHomeAddress="" Then 
				strBill="select a.Owner,a.OwnerZip,a.OwnerAddress,a.DriverHomeZip,a.DriverHomeAddress,a.Driver from billbasedcireturn a where a.ExchangeTypeID='A' and a.Carno='"&CarNo&"'"

				set rsBill=conn.execute(strBill)
					if not rsBill.eof Then
						ZipName=""
							strZip="select ZipName from Zip where ZipID='"&trim(rsBill("OwnerZip"))&"'"
							set rsZip=conn.execute(strZip)
							if not rsZip.eof then
								ZipName=trim(rsZip("ZipName"))
							end if
							rsZip.close
							set rsZip=Nothing

							GetMailAddress=ZipName&trim(rsBill("OwnerAddress"))
							GetMailAddress=replace(GetMailAddress,ZipName&ZipName,ZipName)

							strZip="select ZipName from Zip where ZipID='"&trim(rsBill("DriverHomeZip"))&"'"
							set rsZip=conn.execute(strZip)
							if not rsZip.eof then
								ZipName2=trim(rsZip("ZipName"))
							end if
							rsZip.close
							set rsZip=nothing


						Owner=trim(rsBill("Owner"))
						OwnerZip=trim(rsBill("OwnerZip"))
						 Sys_DriverHomeZip=trim(rsBill("DriverHomeZip"))
						 Sys_DriverHomeAddress=ZipName2&trim(rsBill("DriverHomeAddress"))
							Sys_DriverHomeAddress=replace(Sys_DriverHomeAddress,ZipName2&ZipName2,ZipName2)

						 Sys_Driver=trim(rsBill("Driver"))

					End if
				End If 
			End if
		end If
	rsBill.close
	set rsBill=nothing	

'-------------------------------------------------------------------------------------
	%>
		<table border="0" width="80%" id="table1" cellspacing="0" cellpadding="0">
		<tr>
			<td height="100" width="60%">
				<p align="center">
				<font face="標楷體" size="5"><%
				if (Sys_BillTypeID="1") and trim(Sys_DriverHomeAddress)<>"" Then
				  If Trim(Sys_Driver)="" Then 				
					response.write Owner 
				  Else
					response.write Sys_Driver 
				  End if
				else
					response.write Owner				
				end if
				%>				
				<%if sys_City="彰化縣" then
				response.write "　先生/女士"
				end if
				%>
				</font></td>
    <td>
              <p align="left">
              <img src="..\BarCodeImage\<%=Sys_BillNo_BarCode%>.jpg"><font face="標楷體" size="2"><%if sys_City="台中縣" then  response.write StationName%></font></td>
    		</tr>
	    	<tr>
			<td height="120" align="left" valign="top" colspan="2">
				<font face="標楷體" size="5"><%
				if (Sys_BillTypeID="1" or (sys_City="宜蘭縣" and trim(Session("Ch_Name"))="楊玉燕")) and trim(Sys_DriverHomeAddress)<>"" then 
				  If Trim(Sys_DriverHomeZip)="" Then 
					response.write OwnerZip 
				  Else
					response.write Sys_DriverHomeZip 
				  End if
				else 
					response.write OwnerZip
				end if
				%>&nbsp;<%
				if (Sys_BillTypeID="1" or (sys_City="宜蘭縣" and trim(Session("Ch_Name"))="楊玉燕")) and trim(Sys_DriverHomeAddress)<>"" then 
				  If Trim(Sys_DriverHomeAddress)="" Then 
					response.write GetMailAddress
				  Else
					response.write Sys_DriverHomeAddress
				  End if
				else
					response.write GetMailAddress 
				end if
				%></font>
         　</td>
		</tr>
	</table>
	<% 
end if	
	'---------------------------------------------------------------------------------------
	if (i+2 < Ubound(PBillSN)) or (i+2 = Ubound(PBillSN))then 
strBill="select b.Billno,b.CarNo,a.Owner,a.DriverHomeZip,a.Driver,b.BillTypeID,a.DriverHomeAddress,a.OwnerZip,a.OwnerAddress,c.StationName from billbasedcireturn a,Billbase b,Station c where a.DciReturnStation=c.DCIStationID(+) and a.BillNO=b.BillNo and a.CarNo=b.CarNo and a.ExchangeTypeID='W' and b.SN="&PBillSN(i+2)
set rsBill=conn.execute(strBill)
			GetMailAddress=""
			Billno=""
			StationName=""
			CarNo=""
			Owner=""
			Sys_BillTypeID=""
			OwnerZip=""
			 Sys_DriverHomeAddress=""
             Sys_DriverHomeZip=""
    	     Sys_Driver=""
			Sys_BillNo_BarCode=""
			ZipName2=""
		if not rsBill.eof then
		if sys_City="基隆市" or sys_City="金門縣" or sys_City="澎湖縣" then
				ZipName=""
			else
				strZip="select ZipName from Zip where ZipID='"&trim(rsBill("OwnerZip"))&"'"
				set rsZip=conn.execute(strZip)
				if not rsZip.eof then
					ZipName=trim(rsZip("ZipName"))
				end if
				rsZip.close
				set rsZip=nothing
				strZip="select ZipName from Zip where ZipID='"&trim(rsBill("DriverHomeZip"))&"'"
				set rsZip=conn.execute(strZip)
				if not rsZip.eof then
					ZipName2=trim(rsZip("ZipName"))
				end if
				rsZip.close
				set rsZip=nothing
			end if
				GetMailAddress=ZipName&trim(rsBill("OwnerAddress"))
			
			Billno=trim(rsBill("Billno"))
			StationName=trim(rsBill("StationName"))
			CarNo=trim(rsBill("CarNo"))
			Owner=trim(rsBill("Owner"))
			Sys_BillTypeID=trim(rsBill("BillTypeID"))
			OwnerZip=trim(rsBill("OwnerZip"))
			
			 Sys_DriverHomeAddress=ZipName2&trim(rsBill("DriverHomeAddress"))
                 Sys_DriverHomeZip=trim(rsBill("DriverHomeZip"))
			     Sys_Driver=trim(rsBill("Driver"))

			Sys_BillNo_BarCode=BillNo
			
            	DelphiASPObj.GenSendStoreBillno BillNo,0,50,160
			If sys_City="台東縣" Then 
				If Driver="" Or Sys_DriverHomeAddress="" Then 
				strBill="select a.Owner,a.OwnerZip,a.OwnerAddress,a.DriverHomeZip,a.DriverHomeAddress,a.Driver from billbasedcireturn a where a.ExchangeTypeID='A' and a.Carno='"&CarNo&"'"

				set rsBill=conn.execute(strBill)
					if not rsBill.eof Then
						ZipName=""
							strZip="select ZipName from Zip where ZipID='"&trim(rsBill("OwnerZip"))&"'"
							set rsZip=conn.execute(strZip)
							if not rsZip.eof then
								ZipName=trim(rsZip("ZipName"))
							end if
							rsZip.close
							set rsZip=Nothing

							GetMailAddress=ZipName&trim(rsBill("OwnerAddress"))
							GetMailAddress=replace(GetMailAddress,ZipName&ZipName,ZipName)

							strZip="select ZipName from Zip where ZipID='"&trim(rsBill("DriverHomeZip"))&"'"
							set rsZip=conn.execute(strZip)
							if not rsZip.eof then
								ZipName2=trim(rsZip("ZipName"))
							end if
							rsZip.close
							set rsZip=nothing


						Owner=trim(rsBill("Owner"))
						OwnerZip=trim(rsBill("OwnerZip"))
						 Sys_DriverHomeZip=trim(rsBill("DriverHomeZip"))
						 Sys_DriverHomeAddress=ZipName2&trim(rsBill("DriverHomeAddress"))
							Sys_DriverHomeAddress=replace(Sys_DriverHomeAddress,ZipName2&ZipName2,ZipName2)

						 Sys_Driver=trim(rsBill("Driver"))

					End if
				End If 
			End if
		end If
	rsBill.close
	set rsBill=nothing	

'-------------------------------------------------------------------------------------
	%>
	
		<table border="0" width="80%" id="table1" cellspacing="0" cellpadding="0">
		<tr>
			<td height="100" width="60%">
				<p align="center">
				<font face="標楷體" size="5"><%
				if (Sys_BillTypeID="1")  and trim(Sys_DriverHomeAddress)<>"" then 
				  If Trim(Sys_Driver)="" Then 				
					response.write Owner 
				  Else
					response.write Sys_Driver 
				  End if
				else 
					response.write Owner
				end if
				%>				
				<%if sys_City="彰化縣" then
				response.write "　先生/女士"
				end if
				%>
    <td>
              <p align="left">
              <img src="..\BarCodeImage\<%=Sys_BillNo_BarCode%>.jpg"><font face="標楷體" size="2"><%if sys_City="台中縣" then  response.write StationName%></font></td>
    		</tr>
	    	<tr>
			<td height="120" align="left" valign="top" colspan="2">
				<font face="標楷體" size="5"><%
				if (Sys_BillTypeID="1" or (sys_City="宜蘭縣" and trim(Session("Ch_Name"))="楊玉燕")) and trim(Sys_DriverHomeAddress)<>"" then 
				  If Trim(Sys_DriverHomeZip)="" Then 
					response.write OwnerZip 
				  Else
					response.write Sys_DriverHomeZip 
				  End if
				else 
					response.write OwnerZip 
				end if
				%>&nbsp;<%
				if (Sys_BillTypeID="1" or (sys_City="宜蘭縣" and trim(Session("Ch_Name"))="楊玉燕"))  and trim(Sys_DriverHomeAddress)<>"" then 
				  If Trim(Sys_DriverHomeAddress)="" Then 
					response.write GetMailAddress
				  Else
					response.write Sys_DriverHomeAddress
				  End if
				else 
					response.write GetMailAddress 
				end if
				%></font>
         　</td>
		</tr>
	</table>
	<% 
	'---------------------------------------------------------------------------------------
	end if
	if (i+3 < Ubound(PBillSN)) or (i+3 = Ubound(PBillSN))then 
strBill="select b.Billno,b.CarNo,a.Owner,a.DriverHomeZip,a.Driver,b.BillTypeID,a.DriverHomeAddress,a.OwnerZip,a.OwnerAddress,c.StationName from billbasedcireturn a,Billbase b,Station c where a.DciReturnStation=c.DCIStationID(+) and a.BillNO=b.BillNo and a.CarNo=b.CarNo and a.ExchangeTypeID='W' and b.SN="&PBillSN(i+3)
set rsBill=conn.execute(strBill)
			GetMailAddress=""
			Billno=""
			StationName=""
			CarNo=""
			Owner=""
			Sys_BillTypeID=""
			OwnerZip=""
			 Sys_DriverHomeAddress=""
             Sys_DriverHomeZip=""
    	     Sys_Driver=""
			Sys_BillNo_BarCode=""
			ZipName2=""
		if not rsBill.eof then
		
	    	if sys_City="基隆市" or sys_City="金門縣" or sys_City="澎湖縣" then
				ZipName=""
			else
				strZip="select ZipName from Zip where ZipID='"&trim(rsBill("OwnerZip"))&"'"
				set rsZip=conn.execute(strZip)
				if not rsZip.eof then
					ZipName=trim(rsZip("ZipName"))
				end if
				rsZip.close
				set rsZip=nothing
				strZip="select ZipName from Zip where ZipID='"&trim(rsBill("DriverHomeZip"))&"'"
				set rsZip=conn.execute(strZip)
				if not rsZip.eof then
					ZipName2=trim(rsZip("ZipName"))
				end if
				rsZip.close
				set rsZip=nothing
			end if
				GetMailAddress=ZipName&trim(rsBill("OwnerAddress"))
			
			Billno=trim(rsBill("Billno"))
			StationName=trim(rsBill("StationName"))
			CarNo=trim(rsBill("CarNo"))
			Owner=trim(rsBill("Owner"))
			Sys_BillTypeID=trim(rsBill("BillTypeID"))
			OwnerZip=trim(rsBill("OwnerZip"))
			
			Sys_DriverHomeAddress=ZipName2&trim(rsBill("DriverHomeAddress"))
            Sys_DriverHomeZip=trim(rsBill("DriverHomeZip"))
			Sys_Driver=trim(rsBill("Driver"))

			Sys_BillNo_BarCode=BillNo
			
            	DelphiASPObj.GenSendStoreBillno BillNo,0,50,160
			If sys_City="台東縣" Then 
				If Driver="" Or Sys_DriverHomeAddress="" Then 
				strBill="select a.Owner,a.OwnerZip,a.OwnerAddress,a.DriverHomeZip,a.DriverHomeAddress,a.Driver from billbasedcireturn a where a.ExchangeTypeID='A' and a.Carno='"&CarNo&"'"

				set rsBill=conn.execute(strBill)
					if not rsBill.eof Then
						ZipName=""
							strZip="select ZipName from Zip where ZipID='"&trim(rsBill("OwnerZip"))&"'"
							set rsZip=conn.execute(strZip)
							if not rsZip.eof then
								ZipName=trim(rsZip("ZipName"))
							end if
							rsZip.close
							set rsZip=Nothing

							GetMailAddress=ZipName&trim(rsBill("OwnerAddress"))
							GetMailAddress=replace(GetMailAddress,ZipName&ZipName,ZipName)

							strZip="select ZipName from Zip where ZipID='"&trim(rsBill("DriverHomeZip"))&"'"
							set rsZip=conn.execute(strZip)
							if not rsZip.eof then
								ZipName2=trim(rsZip("ZipName"))
							end if
							rsZip.close
							set rsZip=nothing


						Owner=trim(rsBill("Owner"))
						OwnerZip=trim(rsBill("OwnerZip"))
						 Sys_DriverHomeZip=trim(rsBill("DriverHomeZip"))
						 Sys_DriverHomeAddress=ZipName2&trim(rsBill("DriverHomeAddress"))
							Sys_DriverHomeAddress=replace(Sys_DriverHomeAddress,ZipName2&ZipName2,ZipName2)

						 Sys_Driver=trim(rsBill("Driver"))

					End if
				End If 
			End if
		end If
	rsBill.close
	set rsBill=nothing	

'-------------------------------------------------------------------------------------
	%>
	
		<table border="0" width="80%" id="table1" cellspacing="0" cellpadding="0">
		<tr>
			<td height="100" width="60%">
				<p align="center">
				<font face="標楷體" size="5"><%
				if (Sys_BillTypeID="1") and trim(Sys_DriverHomeAddress)<>"" then
				  If Trim(Sys_Driver)="" Then 				
					response.write Owner 
				  Else
					response.write Sys_Driver 
				  End if
				else
					response.write Owner
				end if
				%>				
				<%if sys_City="彰化縣" then
				response.write "　先生/女士"
				end if
				%>
    <td>
              <p align="left">
              <img src="..\BarCodeImage\<%=Sys_BillNo_BarCode%>.jpg"><font face="標楷體" size="2"><%if sys_City="台中縣" then  response.write StationName%></font></td>
    		</tr>
	    	<tr>
			<td height="120" align="left" valign="top" colspan="2">
				<font face="標楷體" size="5"><%
				if (Sys_BillTypeID="1" or (sys_City="宜蘭縣" and trim(Session("Ch_Name"))="楊玉燕")) and trim(Sys_DriverHomeAddress)<>"" then
				  If Trim(Sys_DriverHomeZip)="" Then 
					response.write OwnerZip 
				  Else
					response.write Sys_DriverHomeZip 
				  End if

				else 
					response.write OwnerZip  
				end if
				%>&nbsp;<%
				if (Sys_BillTypeID="1" or (sys_City="宜蘭縣" and trim(Session("Ch_Name"))="楊玉燕")) and trim(Sys_DriverHomeAddress)<>"" then 
				  If Trim(Sys_DriverHomeAddress)="" Then 
					response.write GetMailAddress
				  Else
					response.write Sys_DriverHomeAddress
				  End if
				else 
					response.write GetMailAddress 
				end if
				%></font>
         　</td>
		</tr>
	</table>
	<% 
	'---------------------------------------------------------------------------------------
	end if
	if (i+4 < Ubound(PBillSN)) or (i+4 = Ubound(PBillSN))then 
strBill="select b.Billno,b.CarNo,a.Owner,a.DriverHomeZip,a.Driver,b.BillTypeID,a.DriverHomeAddress,a.OwnerZip,a.OwnerAddress,c.StationName from billbasedcireturn a,Billbase b,Station c where a.DciReturnStation=c.DCIStationID(+) and a.BillNO=b.BillNo and a.CarNo=b.CarNo and a.ExchangeTypeID='W' and b.SN="&PBillSN(i+4)
set rsBill=conn.execute(strBill)
			GetMailAddress=""
			Billno=""
			StationName=""
			CarNo=""
			Owner=""
			Sys_BillTypeID=""
			OwnerZip=""
			 Sys_DriverHomeAddress=""
             Sys_DriverHomeZip=""
    	     Sys_Driver=""
			Sys_BillNo_BarCode=""
			ZipName2=""
		if not rsBill.eof then
		
	    	if sys_City="基隆市" or sys_City="金門縣" or sys_City="澎湖縣"  then
				ZipName=""
			else
				strZip="select ZipName from Zip where ZipID='"&trim(rsBill("OwnerZip"))&"'"
				set rsZip=conn.execute(strZip)
				if not rsZip.eof then
					ZipName=trim(rsZip("ZipName"))
				end if
				rsZip.close
				set rsZip=nothing
				strZip="select ZipName from Zip where ZipID='"&trim(rsBill("DriverHomeZip"))&"'"
				set rsZip=conn.execute(strZip)
				if not rsZip.eof then
					ZipName2=trim(rsZip("ZipName"))
				end if
				rsZip.close
				set rsZip=nothing
			end if
				GetMailAddress=ZipName&trim(rsBill("OwnerAddress"))
			
			Billno=trim(rsBill("Billno"))
			StationName=trim(rsBill("StationName"))
			CarNo=trim(rsBill("CarNo"))
			Owner=trim(rsBill("Owner"))
			Sys_BillTypeID=trim(rsBill("BillTypeID"))
			OwnerZip=trim(rsBill("OwnerZip"))
			
			Sys_DriverHomeAddress=ZipName2&trim(rsBill("DriverHomeAddress"))
            Sys_DriverHomeZip=trim(rsBill("DriverHomeZip"))
			Sys_Driver=trim(rsBill("Driver"))

			Sys_BillNo_BarCode=BillNo
			
            	DelphiASPObj.GenSendStoreBillno BillNo,0,50,160
			If sys_City="台東縣" Then 
				If Driver="" Or Sys_DriverHomeAddress="" Then 
				strBill="select a.Owner,a.OwnerZip,a.OwnerAddress,a.DriverHomeZip,a.DriverHomeAddress,a.Driver from billbasedcireturn a where a.ExchangeTypeID='A' and a.Carno='"&CarNo&"'"

				set rsBill=conn.execute(strBill)
					if not rsBill.eof Then
						ZipName=""
							strZip="select ZipName from Zip where ZipID='"&trim(rsBill("OwnerZip"))&"'"
							set rsZip=conn.execute(strZip)
							if not rsZip.eof then
								ZipName=trim(rsZip("ZipName"))
							end if
							rsZip.close
							set rsZip=Nothing

							GetMailAddress=ZipName&trim(rsBill("OwnerAddress"))
							GetMailAddress=replace(GetMailAddress,ZipName&ZipName,ZipName)

							strZip="select ZipName from Zip where ZipID='"&trim(rsBill("DriverHomeZip"))&"'"
							set rsZip=conn.execute(strZip)
							if not rsZip.eof then
								ZipName2=trim(rsZip("ZipName"))
							end if
							rsZip.close
							set rsZip=nothing


						Owner=trim(rsBill("Owner"))
						OwnerZip=trim(rsBill("OwnerZip"))
						 Sys_DriverHomeZip=trim(rsBill("DriverHomeZip"))
						 Sys_DriverHomeAddress=ZipName2&trim(rsBill("DriverHomeAddress"))
							Sys_DriverHomeAddress=replace(Sys_DriverHomeAddress,ZipName2&ZipName2,ZipName2)

						 Sys_Driver=trim(rsBill("Driver"))

					End if
				End If 
			End if
		end If
	rsBill.close
	set rsBill=nothing	

'-------------------------------------------------------------------------------------
	%>
	
		<table border="0" width="80%" id="table1" cellspacing="0" cellpadding="0">
		<tr>
			<td height="100" width="60%">
				<p align="center">
				<font face="標楷體" size="5"><%
				if (Sys_BillTypeID="1") and trim(Sys_DriverHomeAddress)<>"" then
				  If Trim(Sys_Driver)="" Then 				
					response.write Owner 
				  Else
					response.write Sys_Driver 
				  End if
				else 
					response.write Owner
				end if
				%>				
				<%if sys_City="彰化縣" then
				response.write "　先生/女士"
				end if
				%>
    <td>
              <p align="left">
              <img src="..\BarCodeImage\<%=Sys_BillNo_BarCode%>.jpg"><font face="標楷體" size="2"><%if sys_City="台中縣" then  response.write StationName%></font></td>
    		</tr>
	    	<tr>
			<td height="50" align="left" valign="top" colspan="2">
				<font face="標楷體" size="5"><%
				if (Sys_BillTypeID="1" or (sys_City="宜蘭縣" and trim(Session("Ch_Name"))="楊玉燕"))  and trim(Sys_DriverHomeAddress)<>""  then 
				  If Trim(Sys_DriverHomeZip)="" Then 
					response.write OwnerZip 
				  Else
					response.write Sys_DriverHomeZip 
				  End if
				else
					response.write OwnerZip 
				end if
				%>&nbsp;<%
				if (Sys_BillTypeID="1"  or (sys_City="宜蘭縣" and trim(Session("Ch_Name"))="楊玉燕"))  then 
				  If Trim(Sys_DriverHomeAddress)="" Then 
					response.write GetMailAddress
				  Else
					response.write Sys_DriverHomeAddress
				  End if
				else 
					response.write GetMailAddress 
				end if
				%></font>
         　</td>
		</tr>
	</table>
	
<% 
	end if
end if
%>
<%next%>
</body>
<object id=factory style="display:none"
classid="clsid:1663ed61-23eb-11d2-b92f-008048fdd814"
codebase="../smsx.cab#Version=6,1,432,1">
</object>
<script type="text/javascript" src="../js/Print.js"></script>
<script language="javascript">
printWindow(true,5.08,5.08,5.08,5.08);
</script></p>