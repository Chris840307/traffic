<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<object id=factory style="display:none"
classid="clsid:1663ed61-23eb-11d2-b92f-008048fdd814"
codebase="..\smsx.cab#Version=6,1,432,1">
</object>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=big5">
<style type="text/css">
<!--
.style3 {font-family:新細明體; color=0044ff; line-height:19px; font-size: 15px}
.style4 {font-family:新細明體;  line-height:19px;font-size: 12pt}
-->
</style>
<style media=print>
.Noprint{display:none;}
.PageNext{page-break-after: always;}
</style>
<title>退件清冊</title>
<script type="text/javascript" src="../js/Print.js"></script>
<!--#include virtual="traffic/Common/cssForForm.txt"-->
<!--#include virtual="traffic/Common/DB.ini"-->
<!--#include virtual="traffic/Common/AllFunction.inc"-->
<!--#include virtual="traffic/Common/Login_Check.asp"--> 
<%
Server.ScriptTimeout = 800
Response.flush
%>
<%
'權限
'AuthorityCheck(234)

strCity="select value from Apconfigure where id=31"
set rsCity=conn.execute(strCity)
	sys_City=trim(rsCity("value"))
rsCity.close
set rsCity=nothing
%>
<%
	strwhere=request("SQLstr")
%>

</head>
<body>
<form name=myForm method="post">
<%	
	TitleValue=""
	strUnitName2="select UnitName from UnitInfo where UnitID='"&trim(Session("Unit_ID"))&"'"
	set rsUnitName2=conn.execute(strUnitName2)
	if not rsUnitName2.eof then
		TitleUnitName2=trim(rsUnitName2("UnitName"))
	end if
	rsUnitName2.close
	set rsUnitName2=nothing

	strTitle="select Value from Apconfigure where ID=31"
	set rsTitle=conn.execute(strTitle)
	if not rsTitle.eof then
		TitleValue=rsTitle("Value")
	end if
	rsTitle.close
	set rsTitle=nothing

	PrintSN=0
%>
<%		
		UserMarkDate1=gOutDT(request("Sys_UserMarkDate1"))&" 0:0:0"
		UserMarkDate2=gOutDT(request("Sys_UserMarkDate2"))&" 23:59:59"
		strwhere=" and g.UserMarkDate between TO_DATE('"&UserMarkDate1&"','YYYY/MM/DD/HH24/MI/SS') and TO_DATE('"&UserMarkDate2&"','YYYY/MM/DD/HH24/MI/SS')"

		strCnt="select count(*) as cnt" &_
		" from BillBase a,DciLog b,BillBaseDciReturn e,StopBillMailHistory g" &_
		" where a.Sn=b.BillSn and a.CarNo=e.CarNo and a.Sn=g.BillSn" &_
		" and a.RecordStateID=0 and g.UserMarkResonID in ('5','6','7','T')" &strwhere &_
		" order by g.UserMarkDate"
		set rsCnt=conn.execute(strCnt)
		if not rsCnt.eof then
			GetCnt=cint(rsCnt("Cnt"))
		end if
		rsCnt.close
		set rsCnt=nothing

		MaxDate=now
		MinDate=now
		strDate="select Max(IllegalDate) as MaxDate,Min(IllegalDate) as MinDate" &_
		" from BillBase a,DciLog b,BillBaseDciReturn e,StopBillMailHistory g" &_
		" where a.Sn=b.BillSn and a.CarNo=e.CarNo and a.Sn=g.BillSn" &_
		" and a.RecordStateID=0 and g.UserMarkResonID in ('5','6','7','T')" &strwhere &_
		" order by g.UserMarkDate"
		set rsDate=conn.execute(strDate)
		if not rsDate.eof then
			MaxDate=rsDate("MaxDate")
			MinDate=rsDate("MinDate")
		end if
		rsDate.close
		set rsDate=nothing

		strSQL="select a.SN,a.BillNO,a.CarNO,e.Owner,a.CarSimpleID,a.IllegalDate" &_
		",a.Rule1,a.Rule2,a.Rule3,a.Rule4,a.BillUnitID,a.BillMem1,a.BillMem2,a.ImageFileNameB,g.UserMarkResonID" &_
		" from BillBase a,DciLog b,BillBaseDciReturn e,StopBillMailHistory g" &_
		" where a.Sn=b.BillSn and a.CarNo=e.CarNo and a.Sn=g.BillSn" &_
		" and a.RecordStateID=0 and g.UserMarkResonID in ('5','6','7','T')" &strwhere &_
		" order by g.UserMarkDate"
		set rs1=conn.execute(strSQL)
		If Not rs1.Bof Then rs1.MoveFirst 
		While Not rs1.Eof
		if PrintSN>0 then response.write "<div class=""PageNext""></div>"
%>		
	<table width="100%" border="1" cellpadding="0" cellspacing="0">
	<tr>
		<td align="center" height="75" colspan="5"><span class="style4"><%
			response.write TitleValue&"公有路邊收費停車場停車費催繳單郵寄無法送達清冊"
			response.write "<br>"
			response.write "<br>"
			response.write "<div align=""right"">停車日期："&year(MinDate)&"/"&month(MinDate)&"/"&Day(MinDate)&"~"
			response.write year(MaxDate)&"/"&month(MaxDate)&"/"&Day(MaxDate)&"&nbsp; &nbsp;</div>"
			if GetCnt="0" then
				pagecnt=1
			else
				pagecnt=fix(GetCnt/20+0.9999999)
			end if
		%></span></td>
	</tr>
	<tr>
		<td align="center" height="40" width="8%"><span class="style4">編號</span></td>
		<td align="center" width="20%"><span class="style4">催繳單號</span></td>
		<td align="center" width="12%"><span class="style4">車號</span></td>
		<td align="center" width="35%"><span class="style4">車主姓名</span></td>
		<td align="center" width="25%"><span class="style4">退件原因</span></td>
	</tr>
<%		for i=1 to 20
			if rs1.eof then exit for
			PrintSN=PrintSN+1
%>
	<tr>
		<td align="center" height="40"><span class="style4"><%
		'編號
		response.write PrintSN
		%></span></td>
		<td align="center"><span class="style4"><%
		'催繳單號
		response.write trim(rs1("ImageFileNameB"))
		%></span></td>
		<td align="center"><span class="style4"><%
		'車號
		response.write trim(rs1("CarNo"))
		%></span></td>
		<td align="center"><span class="style4"><%
		'車主姓名
		response.write trim(rs1("Owner"))
		%></span></td>
		<td align="center"><span class="style4"><%
		'退件原因
		strCode="select Content from DCIcode where TypeID=7 and ID='"&trim(rs1("UserMarkResonID"))&"'"
		set rsCode=conn.execute(strCode)
		if not rsCode.eof then
			response.write trim(rsCode("Content"))
		end if
		rsCode.close
		set rsCode=nothing
		%></span></td>
	</tr>
<%			
		rs1.MoveNext
		next
%>
	</table>
<%
		Wend
		rs1.close
		set rs1=nothing
%>		

</form>
</body>
</html>
<script language="javascript">
function DP(){
	window.focus();
	window.print();
}

printWindow(true,8,8.08,8.08,8.08);
</script>
<%conn.close%>